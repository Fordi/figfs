.PHONY: all clean test

USE_OCAMLFIND = true

OCAMLPACKS[] =
   unix
   oUnit

OCAML_LIBS[] =
   zlib

.DEFAULT: $(StaticCLibrary libzlibstub, zlibstub) \
          zlib.cmxa zlib.a \
          $(OCamlProgram zlib_test, zlib_test)

zlib.cmxa zlib.a: zlib.cmx
   $(OCAMLOPT) -a -o zlib.cmxa zlib.cmx -cclib -lzlibstub -cclib -lz 

clean:
   rm -f zlib.cmi zlib.cmx zlib.o zlib.cmxa zlib.a \
         zlibstub.o libzlibstub.a \
         zlib_test zlib_test.opt zlib_test.cmi zlib_test.cmx zlib_test.o

test:
   ./zlib_test.opt
